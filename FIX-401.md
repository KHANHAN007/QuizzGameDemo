# ğŸ”§ Fix 401 Unauthorized Error

## Váº¥n Ä‘á»

- API tráº£ vá» 401 khi gá»i `/api/assignments`
- Lá»—i: Token khÃ´ng Ä‘Æ°á»£c gá»­i hoáº·c khÃ´ng há»£p lá»‡

## âœ… ÄÃ£ fix

### 1. API Interceptor (api.js)

ThÃªm interceptor tá»± Ä‘á»™ng láº¥y token tá»« localStorage má»—i request:

```javascript
api.interceptors.request.use((config) => {
  const token = localStorage.getItem("token");
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});
```

### 2. Auto redirect on 401

```javascript
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      window.location.href = "/login";
    }
    return Promise.reject(error);
  }
);
```

## ğŸ§ª CÃ¡ch test

### BÆ°á»›c 1: Clear vÃ  Login láº¡i

Má»Ÿ DevTools Console (F12) vÃ  cháº¡y:

```javascript
// Clear storage
localStorage.clear();

// Reload
location.reload();
```

### BÆ°á»›c 2: Login vá»›i teacher1

1. Click "ÄÄƒng nháº­p"
2. Click button quick login "teacher1"
3. Check console log

### BÆ°á»›c 3: Test API

Truy cáº­p: http://localhost:5173/test-api

Click cÃ¡c buttons:

- âœ… Check localStorage - xem token cÃ³ Ä‘Æ°á»£c lÆ°u khÃ´ng
- âœ… Test Health - test endpoint public
- âœ… Test Profile - test endpoint cÃ³ auth
- âœ… Test Assignments - test endpoint assignments

### BÆ°á»›c 4: Check Network tab

1. Má»Ÿ DevTools > Network tab
2. Reload trang /teacher/assignments
3. Click vÃ o request `/api/assignments`
4. Check **Headers** section:
   - Pháº£i cÃ³: `Authorization: Bearer <token>`

## ğŸ› Náº¿u váº«n lá»—i

### Check 1: Token format

Má»Ÿ Console:

```javascript
const token = localStorage.getItem("token");
console.log("Token:", token);
console.log("Token starts with:", token.substring(0, 20));
```

Token pháº£i cÃ³ dáº¡ng: `eyJ1c2VySWQiOjEsInJ...`

### Check 2: Backend verification

Test API trá»±c tiáº¿p vá»›i curl:

```powershell
# Login
$body = '{"username":"teacher1","password":"password123"}'
$response = Invoke-RestMethod -Method POST -Uri "https://quiz-game-api.quiz-game-khanhan.workers.dev/api/auth/login" -ContentType "application/json" -Body $body
$token = $response.token

# Test assignments
$headers = @{ "Authorization" = "Bearer $token" }
Invoke-RestMethod -Method GET -Uri "https://quiz-game-api.quiz-game-khanhan.workers.dev/api/assignments" -Headers $headers
```

### Check 3: Token expiry

Token cÃ³ thá»i háº¡n 7 ngÃ y. Náº¿u quÃ¡ háº¡n pháº£i login láº¡i.

## ğŸ“ Files Ä‘Ã£ sá»­a

- âœ… `frontend/src/api.js` - Added interceptors
- âœ… `frontend/src/pages/TestAPI.jsx` - Debug page
- âœ… `frontend/src/App.jsx` - Added /test-api route

## ğŸ¯ Next Steps

1. Clear localStorage
2. Login láº¡i
3. Test /teacher/assignments
4. Náº¿u OK â†’ Import sample assignments
5. Test full flow!
